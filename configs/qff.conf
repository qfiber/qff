# configs/qff.conf
# QFF - qFibre Firewall Manager Configuration
# All settings are now managed from this file.

# ==============================================================================
# CONFIGURATION NOTES:
# ==============================================================================
#
# - default_policy=drop: The firewall will block all incoming traffic by default,
#   except for ports explicitly listed in the [ports] section.
# - Outbound traffic is allowed by default.
# - Country blocking: If country_allow_file has entries, only those countries
#   are allowed. Otherwise, if country_block_file has entries, those
#   countries are blocked. If both are empty, all countries are allowed.
#
# ==============================================================================

[firewall]
# Basic firewall settings. Options: drop, accept
default_policy=drop
enable_ipv6=true
# Log level for the application. Options: debug, info, warn, error
log_level=info
# Graceful shutdown period for the service.
shutdown_timeout=30s

[server]
# API Server settings
api_port=8080

[ports]
# Comma-separated list of allowed INBOUND ports.
tcp_in=22,80,443
udp_in=53

# Comma-separated list of allowed OUTBOUND ports.
tcp_out=53,80,443,587
udp_out=53

[ips]
# Intrusion Prevention System
enabled=true
log_check_interval=30s
block_duration=1h
perm_block_threshold=3

# Log file paths (can be overridden from these defaults)
auth_log_files=/var/log/auth.log,/var/log/secure
apache_log_files=/var/log/apache2/access.log,/var/log/httpd/access_log
nginx_log_files=/var/log/nginx/access.log

# Auto-whitelist SSH sessions to prevent lockout
auto_whitelist_ssh_sessions=true
ssh_whitelist_duration=24h

# Port scan detection
enable_port_scan_detection=true
port_scan_threshold=15
port_scan_time_window=1m

# File system monitoring
enable_filesystem_monitor=true
critical_files=/etc/passwd,/etc/shadow,/etc/sudoers
file_check_interval=5m

# Process monitoring
enable_process_monitor=true
suspicious_process_patterns=perl /tmp/.*\.pl,wget http.*\.php,curl.*\.sh
process_check_interval=1m

[detection_rules]
# Thresholds for various attack patterns (number of hits before a block)
cpanel_failed_logins=3
directadmin_failed_logins=3
wordpress_failed_logins=5
apache_scan_threshold=10
nginx_scan_threshold=10
ftp_failed_threshold=3
smtp_auth_failed_threshold=5
sql_injection_threshold=1
shell_upload_threshold=1

[blocklists]
# Enable or disable predefined blocklists
spamhaus_enabled=true
dshield_enabled=true
# Add custom blocklist URLs below (e.g., custom_list_1 = http://...)
# custom_list_1 = 

[monitor]
# System resource monitoring
enable_resource_monitoring=true
cpu_alert=true
cpu_threshold=80.0
cpu_duration=5m
memory_alert=true
mem_threshold=80.0
disk_alert=true
disk_threshold=85.0
alert_cooldown=30m

[geoip]
# GeoIP database configuration
mmdb_path=/etc/qff/GeoLite2-Country.mmdb
country_block_file=/etc/qff/countries.block
country_allow_file=/etc/qff/countries.allow
maxmind_api_key=YOUR_MAXMIND_LICENSE_KEY
auto_download=true
enable_vpn_detection=true
vpn_api_key=YOUR_IPQUALITYSCORE_API_KEY
cache_vpn_results=true
cache_expiration=24h

[dns]
# Dynamic DNS support for whitelisting hostnames
enable_dynamic_dns=true
hostnames=home.example.com,office.example.com
update_interval=5m
resolve_timeout=10s
max_concurrent_resolves=10
max_retries=3
retry_backoff=1s

[ratelimit]
# Connection rate limiting for new connections
enable_rate_limit=true
per_ip_conn_limit=100
per_ip_time_window=1m
ban_duration=1h

[security]
enable_bogon_filter=true
bogon_update_interval=24h
max_concurrent_conns_per_ip=50
enable_icmp_flood_protection=true
icmp_flood_rate=5


[notification]
# Email notifications
enable_email=false
email_server=smtp.example.com
email_port=587
email_user=your-email@example.com
email_password=your-app-password
email_to=admin@example.com

# Webhook notifications (Slack, Discord, etc.)
enable_webhooks=false
webhook_urls=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
webhook_timeout=10

[docker]
# Enable to automatically create firewall rules for Docker networking.
docker_enabled=true
# Comma-separated list of Docker subnets to whitelist for host access.
# The default Docker network is usually 172.17.0.0/16.
docker_net=172.17.0.0/16

[port_ratelimit]
# Apply specific rate limits to inbound ports to prevent brute-force attacks.
# Format is protocol_port = count/interval. Supported intervals: second, minute, hour.
# Example: Limit new SSH connections from a single IP to 5 per minute.
tcp_22 = 5

[synflood]
# Basic SYN flood protection using a rate limit on new connections.
# For best results, also enable TCP SYN cookies in your system's sysctl settings.
# |-> Kernel Tuning (Highest Priority): The most effective defense is enabling TCP SYN cookies.
# |-> This is a kernel feature that handles SYN floods with almost no performance impact. 
# |-> vi /etc/sysctl.conf
# |-> net.ipv4.tcp_syncookies = 1
enable_protection=true
# Rate is per-second.
syn_rate_limit=100
syn_burst=50

[testmode]
# Safe testing mode - automatically reverts changes if connectivity is lost
enable_test_mode=false
test_duration=5m
revert_on_failure=true
test_connections=8.8.8.8,1.1.1.1,google.com
test_connection_timeout=3s